Pháº§n 2: ThÃªm há»c sinh â€“ xÃ¡c minh â€“ cá»™ng thÆ°á»Ÿng vÃ o vÃ­
âœ… Chá»©c nÄƒng má»¥c tiÃªu:
GiÃ¡o viÃªn hoáº·c phá»¥ huynh Ä‘Äƒng nháº­p vÃ  thÃªm há»c sinh má»›i mÃ  há» giá»›i thiá»‡u.

Há»c sinh sáº½ á»Ÿ tráº¡ng thÃ¡i "Chá» xÃ¡c minh".

Admin sáº½ vÃ o báº£ng quáº£n trá»‹ â†’ XÃ¡c nháº­n há»c sinh.

Khi Ä‘Æ°á»£c xÃ¡c nháº­n:

âœ… Há»‡ thá»‘ng sáº½ tá»± cá»™ng tiá»n hoáº·c Ä‘iá»ƒm vÃ o vÃ­.

âœ… LÆ°u vÃ o lá»‹ch sá»­ vÃ­ vá»›i tÃªn há»c sinh, ngÃ y thÃ¡ng.

âœ… Kiá»ƒm tra má»‘c 5 há»c sinh Ä‘á»ƒ cá»™ng thÃªm 10 triá»‡u / 10.000 Ä‘iá»ƒm.

ğŸ”© Cáº­p nháº­t cÆ¡ sá»Ÿ dá»¯ liá»‡u
âœ… ThÃªm báº£ng Student:
python
Sao chÃ©p
Chá»‰nh sá»­a
class Student(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    confirmed = db.Column(db.Boolean, default=False)  # Admin xÃ¡c nháº­n
    added_by = db.Column(db.Integer, db.ForeignKey('member.id'), nullable=False)
âœ… Route Ä‘á»ƒ thÃªm há»c sinh
ğŸ“„ Giao diá»‡n Ä‘Æ¡n giáº£n add_student.html:
html
Sao chÃ©p
Chá»‰nh sá»­a
<h2>ThÃªm há»c sinh má»›i</h2>
<form method="POST">
  <input name="name" placeholder="TÃªn há»c sinh" required>
  <button type="submit">Gá»­i yÃªu cáº§u xÃ¡c minh</button>
</form>
ğŸ“ app.py bá»• sung:
python
Sao chÃ©p
Chá»‰nh sá»­a
@app.route('/add-student/<int:member_id>', methods=['GET', 'POST'])
def add_student(member_id):
    member = Member.query.get(member_id)
    if request.method == 'POST':
        name = request.form['name']
        new_student = Student(name=name, added_by=member.id)
        db.session.add(new_student)
        db.session.commit()
        return f"ğŸ“ ÄÃ£ thÃªm há»c sinh {name}, Ä‘ang chá» admin xÃ¡c nháº­n!"
    return render_template('add_student.html', member=member)
âœ… Báº£ng quáº£n trá»‹: Admin xÃ¡c nháº­n há»c sinh
python
Sao chÃ©p
Chá»‰nh sá»­a
@app.route('/admin/students')
def admin_students():
    students = Student.query.filter_by(confirmed=False).all()
    return render_template('admin_students.html', students=students)

@app.route('/admin/confirm/<int:student_id>')
def confirm_student(student_id):
    student = Student.query.get(student_id)
    if student and not student.confirmed:
        student.confirmed = True
        db.session.commit()

        member = Member.query.get(student.added_by)
        wallet = member.wallet
        amount = 2000000 if member.role == 'giaovien' else 2000
        wallet.balance += amount

        # Ghi lá»‹ch sá»­
        note = f"{datetime.now().strftime('%d/%m/%Y')} - Tuyá»ƒn há»c sinh {student.name} - +{amount}\n"
        wallet.history += note

        # Kiá»ƒm tra bonus náº¿u Ä‘á»§ 5 ngÆ°á»i
        count = Student.query.filter_by(added_by=member.id, confirmed=True).count()
        if count % 5 == 0:
            bonus = 10000000 if member.role == 'giaovien' else 10000
            wallet.balance += bonus
            wallet.history += f"ğŸ‰ ThÆ°á»Ÿng Ä‘á»§ {count} há»c sinh - +{bonus}\n"

        db.session.commit()
        return redirect('/admin/students')
    return "KhÃ´ng tÃ¬m tháº¥y há»c sinh hoáº·c Ä‘Ã£ xÃ¡c nháº­n"
ğŸ“„ Giao diá»‡n admin_students.html
html
Sao chÃ©p
Chá»‰nh sá»­a
<h2>Danh sÃ¡ch há»c sinh chá» xÃ¡c minh</h2>
<ul>
{% for s in students %}
  <li>{{ s.name }} - NgÆ°á»i thÃªm: {{ s.added_by }} 
    <a href="/admin/confirm/{{ s.id }}">âœ… XÃ¡c nháº­n</a>
  </li>
{% endfor %}
</ul>
âœ… Sau xÃ¡c nháº­n:
VÃ­ Ä‘Æ°á»£c cá»™ng tiá»n / Ä‘iá»ƒm âœ…
Lá»‹ch sá»­ vÃ­ Ä‘Æ°á»£c cáº­p nháº­t âœ…
Tá»± Ä‘á»™ng cá»™ng thÃªm bonus khi Ä‘áº¡t 5 há»c sinh âœ…